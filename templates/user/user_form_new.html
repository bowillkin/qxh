{% extends "layout.html" %}
{% from "_macro.html" import place_auto_complete_js %}
{% set category='user' %}
{% set title = '新增客户' %}
{% block title %}{{ title }}{% endblock %}
{%- block css -%}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/datetimepicker.css') }}" />
<style type="text/css">
    .form-horizontal .control-label {
        float: left;
        width: 95px;
        background-color: #f5f3ef;
        font-weight: bold;
        border: 1px dashed #ccc;
        padding-top: 4px;
        padding-right: 10px;
        padding-bottom: 4px;
        text-align: right;
        color: #777;
        height: 20px;
        font-size: 13px;
    }

    .form-horizontal .controls {
        margin-left: 120px;
    }

    .form-horizontal .control-group {
        margin-bottom: 2px;
    }

    .accordion-group {
        margin-top: 10px;
    }

    .space {
        margin-right: 15px;
        margin-bottom: 10px;
    }

    .accordion-heading {
        background-color: #fcf8e3;
    }

    .accordion-heading a {
        padding: 0;
        font-weight: bold;
        color: #666;

    }

    .accordion-inner {
        padding-left: 20px;
        padding-bottom: 5px;
        padding-top: 15px;
        background-color: #fcfcfc;
    }

    .entry-group {
        display: block;
        padding: 0px;
    }

    .entry-group-title {
        width: 60px;
        float: left;
        text-align: right;
        padding-right: 5px;

    }

    form hr{
        margin-top: 0px;
        margin-bottom: 15px;
    }

    .accordion-inner table tr td {
        color: #666;
        text-align: left;
    }

    .table-entries{
        font-size: 12px;
    }

    .delete {
        font-weight: bold;
        font-size: 18px;
        color: #000000;
    }

    .say{
        width: 420px;
        max-width: 520px;
    }

    .menubar{
        text-align: right;
        /*background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0044cc));*/
        height: 45px;
        margin-bottom: 165px;
    }

</style>
    <style type="text/css">
        .form-horizontal .control-label {
            float: left;
            width: 100px;
            background-color: #f9f9f9;
            padding-top: 5px;
            padding-right: 10px;
            padding-bottom: 5px;
            text-align: right;
            border-bottom: 1px solid #eeeeee;
            border-right: 1px solid #eeeeee;
        }

        .form-horizontal .controls {
            margin-left: 130px;
        }

        .controls ul li{
            margin-right: 20px;
        }

        .perm-title{
            border: 1px solid #ddd;
            background-color: #f0ede7;
            padding-left: 25px;
            padding-top: 5px;
            height: 25px;
        }
        .perm-title label{
            font-weight: bold;
        }

    </style>
    <style type="text/css">
        .selection{
            width:10px;
            height:10px;
            float:left;
            margin-top:4px;
            margin-right:3px;
            border-radius:5px;
        }

        .data-markup thead{
            height:10px;
            width:50px;
            border:1px solid #000000;
        }

        #market_person{
            width:175x;
        }

        #market_yaofang{
            width:175px;
        }

        #market_gmd{
            width:100px;
        }

        #market_gmx{
            width:100px;
        }

        #market_time{
            width:100px;
        }

    </style>

{%- endblock %}
{% block js -%}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='js/address.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/media.js') }}"></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap-inputmask.min.js') }}"></script>

<script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap-datetimepicker.min.js') }}" charset="UTF-8"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/locales/bootstrap-datetimepicker.zh-CN.js') }}" charset="UTF-8"></script>
<script type="text/javascript">
    var syms = []
    function td_click(symptom){
        var s = "#selection_"+ symptom;
        if($(s).css('background-color')=='rgb(0, 128, 0)'){
            $(s).css({'background-color':''});
            var sub = contains(syms,symptom);
            if(sub>=0){
                syms.splice(sub,1);
            }
        }else{
            $(s).css({'background-color':'green'});
            syms.push(symptom);
        }
        $('.symptoms').val(syms);
    };
    $('#customer_type').val('{{config['OPEARTOR_ASSIGN_USER_TYPES'].get(current_user.assign_user_type)}}');

    function contains(arr, obj) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i] === obj) {
                return i
            }
        }
        return -1;
     }
</script>
<script type="text/javascript">
    $(function () {
        {% if current_user.team =='A2' or current_user.is_admin==1 %}
        new MMMS('m1','m2','m3');
        {% endif %}
		{% if current_user.team in ('A','A1','A2','B','B1','B2')  %}
		$('#dlb_type').select2({
			placeholder: '类型',
			width: '125px'
		});
		$('#dlb_valid').select2({
			placeholder: '是否有效',
			width: '135px'
		});
		$('#dlb_new').select2({
			placeholder: '是否新客户',
			width: '125px'
		});
		$('#dlb_connect').select2({
			placeholder: '是否接通',
			width: '135px'
		});
		{%endif %}
	

        $('#medias select').select2({
            width:'200px'
        });

        $('#gender').select2({
            placeholder: '性别',
            width: '135px'
        });

        <!--$('#connect_situation').select2({-->
            <!--width:'200px'-->
        <!--});-->

        <!--$('#communication_attr').select2({-->
            <!--width:'200px'-->
        <!--});-->

        $('#expect_time').datetimepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd hh:ii',
            minuteStep: 5,
            startDate:new Date(),
            todayBtn: true
        }).on('changeDate', function(ev){
                });

        $('#market_time').datetimepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd hh:ii',
            minuteStep: 5,
            startDate:new Date(),
            todayBtn: true
        }).on('changeDate', function(ev){
                });

        $('#origin').select2({
            placeholder: '客户来源',
            width: '125px'
        });

        $('#activity').select2({
            placeholder: '活动备注',
            width: '125px'
        });
		$('#product_intention').select2({
			placeholder: '产品意向',
			width: '175px'
		});
		$('#product_intention2').select2({
			placeholder: '产品意向2',
			width: '175px'
		});

        $('#assign_operator').select2({
            width:'130px',
            placeholder:'归属员工'
        });
        $('#assign_operator').select2("disable");

        $('#address select').select2({
            width:'155px'
        });

        $('#dialog_type').select2({
            width:'220px'
        });

        $('.entry-select').select2({
            width: '80px'
        });
        <!--{% if current_user.team=='B2' or current_user.is_admin==1 %}-->
        $('#tq_province').select2({
            width: '125px'
        });
        <!--{% endif %}-->

        $('#tq_city').select2({
            width: '125px'
        });

        $('#data_markup').select2({
            width: '175px'
        });

        $('#judge_gm').select2({
            width: '175px'
        });

        $('#judge_valid').select2({
            width: '175px'
        });

        $('#market_province').select2({
            width: '175px'
        });

        $('#market_city').select2({
            width: '175px'
        });


        $('#intent_level').select2({
            width: '125px'
        });

        $('#item').select2({
            width:'280px'
        });

        //$('#birthday').datepicker({
        //    format: 'yyyy-mm-dd',
        //    language: 'zh-CN'});

        $('#birthday').inputmask({
            mask:'9999-99-99'
        });

        $('#talk_time').inputmask({
            mask:'99:99:99'
        });

        function show_err(err) {
            $('#error').show();
            $('#error p').empty().html(err);
            $('html, body').animate({ scrollTop: 0 }, 'slow');
        };


        var selected_concerns = function(){
            var _ids = [];
            $('input[name="concern"]').filter(':checked').each(function() {
                _ids.push($(this).val());
            });
            return _ids;
        };
		var selected_weixin = function () {
			var _ids = [];
			$('input[name="weixins"]').filter(':checked').each(function () {
				_ids.push($(this).val());
			});
			return _ids;
		};

        /*   提交表单   */
        $('form').submit(function () {
            var add_btn = $('button[type="submit"]');

            //验证客户姓名
            var username = $('#name').val();
            if (username==null || username==''){
                show_err('客户姓名不允许为空');
                $('#name').focus();
                return false;
            }

            //验证性别
            var gender = $('#gender').val();
            if (gender==null || gender==''){
                show_err('性别不允许为空');
                $('#gender').focus();
                return false;
            }
            <!--//验证客户出生日期-->
            <!--var birthday = $('#birthday').val()-->
            <!--if( birthday==null || birthday==''){-->
                <!--show_err('出生日期不允许为空');-->
                <!--$('#birthday').focus();-->
                <!--return false;-->
            <!--}-->

            //验证客户年龄
            var ages = $('#ages').val();
            if (ages==null || ages==''){
                show_err('客户年龄不允许为空');
                $('#ages').focus();
                return false;
            }else{
				ages = parseInt(ages);
				if(parseInt(ages)!=ages){
					show_err('客户年龄填写不正确');
					$('#ages').focus();
					return false;
				}else if(ages>99 || ages<10){
					 show_err('客户年龄填写不正确');
					$('#ages').focus();
					return false;
				}
			}

            //验证电话号码
            var phone = $('#phone').val();
            var phone2 = $('#phone2').val();
            var tel = $('#tel').val();
            var tel2 = $('#tel2').val();
            var qq_number = $('#qq_number').val();
            var qq_number2 = $('#qq_number2').val();
            var weixin_number = $('#weixin_number').val();
            var weixin_number2 = $('#weixin_number2').val();

            if((phone==null || phone=='')&&(phone2==null || phone2=='') && (tel==null || tel=='')&&(tel2==null || tel2=='')&&(qq_number==null || qq_number=='')&&(qq_number2==null || qq_number2=='')&&(weixin_number==null || weixin_number=='')&&(weixin_number2==null || weixin_number2=='')){
                show_err('电话，座机，QQ，微信，请必填其中一个。');
                $('#phone').focus();
                return false;
            }else{
                if(phone){
                    if(!validate_phone(phone)){
                        show_err('电话号码输入不正确。本地号码无需+区号028，手机号码首位不允许为0。');
                        $('#phone').focus();
                        return false;
                    }
                }
                <!--if(qq_number || qq_number2){-->
                    <!--if(!validate_phone(qq_number) || !validate_phone(qq_number2)){-->
                        <!--show_err('QQ号码输入不正确。');-->
                        <!--$('#qq_number').focus();-->
                        <!--return false;-->
                    <!--}-->
                <!--}-->
            }

            var other_phones = ['#phone2','#tel','#tel2'];
            for (var i in other_phones ){
                var _phone = other_phones[i];
                var v = $(_phone).val();
                if (v!='' && !validate_phone(v)){
                    show_err('电话号码输入不正确。本地号码无需+区号028，手机号码首位不允许为0。');
                    $(_phone).focus();
                    return false;
                }
            }

            //验证客户来源
            var user_origin = $('#origin').val();
            if(user_origin==''||user_origin==null){
                show_err('请选择客户来源');
                $('#origin').focus();
                return false;
            }
            //验证产品意向
            var product_intention = $('#product_intention').val();
            if(product_intention==''||product_intention==null){
                show_err('请选择产品意向');
                $('#product_intention').focus();
                return false;
            }


            //验证省
            var province = $('#province').val();
            var city = $('#city').val();
            var district = $('#district').val();
            if (province!='' || city!='' || district!=''){
                if(province!='' && city!='' && district!=''){}else{
					show_err('客户地址不允许为空');
					return false;
				}
            }

            //验证省
            <!--var tq_province = $('#tq_province').val();-->
            <!--var tq_city = $('#tq_city').val();-->
            <!--if (tq_province!='' || tq_city!=''){-->
                <!--if(tq_province!='' && tq_province!=''){}else{-->
					<!--show_err('TQ进线地址不允许为空');-->
					<!--return false;-->
				<!--}-->
            <!--}-->

            //验证媒体
            <!--{% if current_user.team =='A2' or current_user.is_admin==1 %}-->
            <!--var m1 = $('#m1').val();-->
            <!--if(m1==''||m1==null){-->
                <!--show_err('请选择媒体来源');-->
                <!--$('#m1').focus();-->
                <!--return false;-->
            <!--}-->
            <!--{% endif %}-->


            add_btn.attr('disabled', true);
            //validate form
            var values = $('form').serializeArray();
            //values.push({name: 'entries', value: JSON.stringify(Entry.data())});
            values.push({name: 'concerns', value: JSON.stringify(selected_concerns())});
        	values.push({name: 'weixin', value: JSON.stringify(selected_weixin())});
			
            var perms = [];
            $('li input[type="checkbox"]:checked').each(function(){
                perms.push($(this).attr('id'));
            });
			values.push({name: 'orgin', value: JSON.stringify(perms)});
			//alert(JSON.stringify(perms));return;
            var req = $.ajax({
                url: "{{ request.path }}",
                dataType: 'json',
                type: 'POST',
                data: $.param(values)});

            req.done(function (data) {
                if (data.result == true) {
                    var data=data.error;
                    window.location.href = "/user/detail/"+data.user_id+'/'+data.token;
                }
                else {
                    show_err(data.error);
                }
            });
            req.fail(function (request, status, err) {
                show_err('发生未知错误，请与管理员联系!');
            });
            req.always(function () {
                add_btn.attr('disabled', false);
            });
            return false;
        });


        $('#user_id').val(0);

        $('input.say').keypress(function(e) {
            if (e.which == 13){
                var new_txt = $(this).val();
                if (new_txt == ''){
                    if ($(this).attr('name')=='yg'){
                        $('input[name=kh]').focus();
                    }
                    else{
                        $('input[name=yg]').focus();
                    }
                    return false;
                }

                var person = $(this).data('person');

                var _area = $('textarea[name=dialog_content]');
                var text = _area.val();
                if (text != ''){text += '\n';}
                text += person+'说：'+new_txt;
                _area.val(text);
                _area.scrollTop(_area[0].scrollHeight - _area.height());
                $(this).val(null);
                if ($(this).attr('name')=='yg'){
                    $('input[name=kh]').focus();
                }
                else{
                    $('input[name=yg]').focus();
                }
                return false;
            }
        });
        /*   地址查询   */
        new PCAS("province", "city", "district");
    $('#address select').change(function () {
        var _name = $(this).attr('name');
        if (_name == 'province') {
            $('#city').select2('val', '').change();
        }
        else if (_name == 'city') {
            $('#district').select2('val', '').change();
        }
		else{
			var _address = "";
			$.each(['#province', '#city', '#district'], function (index, name) {
				var d = $(name).val();
				if (d != "请选择" && d != "市辖县" && d != "市辖区") {
					_address += $(name).val();
				}
			});
			$('#address .add-on').empty().text(_address);
		}
    });
    {% if current_user.team=='B2' or current_user.is_admin==1 %}
        new PCAS("tq_province", "tq_city");
        $('#tq_address select').change(function () {
            var _name = $(this).attr('name');
            if (_name == 'tq_province') {
                $('#tq_city').select2('val', '').change();
            }
            else{
                var _address = "";
                $.each(['#tq_province', '#tq_city'], function (index, name) {
                    var d = $(name).val();
                    if (d != "请选择" && d != "市辖县" && d != "市辖区") {
                        _address += $(name).val();
                    }
                });
                $('#tq_address .add-on').empty().text(_address);
            }
        });
    {% endif %}

    new PCAS("market_province", "market_city");
    $('#address select').change(function () {
        var _name = $(this).attr('name');
        if (_name == 'market_province') {
            $('#market_province').select2('val', '').change();
        }
        else{
            var _address = "";
            $.each(['#market_province', '#market_city'], function (index, name) {
                var d = $(name).val();
                if (d != "请选择" && d != "市辖县" && d != "市辖区") {
                    _address += $(name).val();
                }
            });
            $('#address .add-on').empty().text(_address);
        }
    });
    });
</script>
<script type="text/javascript">
    function add_phones(){
        $('#add_phone').css('display','none');
        $('#phone2').css('display','block');
        $('#phone').css('float','left');
    }

    function add_tels(){
        $('#add_tel').css('display','none');
        $('#tel2').css('display','block');
        $('#tel').css('float','left');
    }

    function add_qqs(){
        $('#add_qq').css('display','none');
        $('#qq_number2').css('display','block');
        $('#qq_number').css('float','left');
    }

    function add_weixins(){
        $('#add_weixin').css('display','none');
        $('#weixin_number2').css('display','block');
        $('#weixin_number').css('float','left');
    }
</script>
{{ place_auto_complete_js() }}
{%- endblock %}

{%- block main -%}
    <ul class="breadcrumb">
{#        <li><a href="#">客户管理</a> <span class="divider">/</span></li>#}
        <li class="active">{{ title }}</li>

    </ul>
    <form id="add-order" class="form-horizontal" method="post" action="{{ request.path }}">
    <fieldset>
    <div class="alert alert-block alert-error fade in" id="error" style="display: none">
        <button type="button" class="close" onclick="$('#error').hide();">&times;</button>
        <p></p>
    </div>

    <div style="display: none">
        <input type="hidden" name="user_id" />
    </div>

    <div class="accordion" id="accordion2" style="margin-bottom: 140px">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#collapseOne">
                <i class="icon-chevron-down"></i> 基本资料
            </a>
        </div>
        <div id="collapseOne" class="accordion-body collapse in">
            <div class="accordion-inner">
                <div class="row-fluid" style="padding-bottom: 0">
                    <div class="span6">

                        <div class="control-group">
                            <label class="control-label">客户姓名</label>

                            <div class="controls">
                                <input id="name" name="name" placeholder="姓名" type="text"
                                       style="width: 85px">
                                <input id="remark" name="remark" placeholder="备注" type="text"
                                       style="width: 125px;color: red">
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">职业</label>

                            <div class="controls">
                                 <input id="profession" name="profession" placeholder="从事行业" type="text">
                            </div>
                        </div>

                    </div>

                    <div class="span6">

                        <div class="control-group">
                            <label class="control-label">性别</label>

                            <div class="controls">
                                <select id="gender" name="gender">
                                    <option></option>
                                    <option value="保密">保密</option>
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">出生/年龄</label>

                            <div class="controls">
                                <input id="birthday" name="birthday" style="width: 145px" type="text"
                                        placeholder="1900-00-00">
                                <input id="ages" name="ages" class="input-small" type="text" placeholder="年龄"  />
                            </div>
                        </div>

                    </div>
                </div>
                <hr/>
                <div class="row-fluid">

                    <div class="span6">
                         <div class="control-group">
                            <label class="control-label">手机号码</label>

                            <div class="controls">
                                <input id="phone" name="phone" style="width: 140px" type="text" placeholder="手机号码" value="{{ request.args.get('phone','') }}">
                                <button type="button" class="btn btn-primary btn-sm" onclick="add_phones();" id="add_phone">新增</button>
                                <input id="phone2" name="phone2"  type="text" style="width: 140px; display:none;" placeholder="手机号码2">

                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">座机电话</label>

                            <div class="controls">
                                <input id="tel" name="tel" style="width: 140px" type="text" placeholder="座机号码">
                                 <button type="button" class="btn btn-primary btn-sm" onclick="add_tels();" id="add_tel">新增</button>
                                <input id="tel2" name="tel2" style="width: 140px; display:none;" type="text" placeholder="座机号码2">
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">归属员工</label>
                            <input type="hidden" value="{{ current_user.id }}" name="assign_operator_hidden"/>
                            <div class="controls">
                                <select name="assign_operator" id="assign_operator">
                                    <option value="{{ current_user.id }}">{{ current_user.nickname }}</option>
                                </select>
                            </div>
                        </div>

                    </div>
                    
                    <div class="span6">
                        
                        <div class="control-group">
                            <label class="control-label">QQ号码</label>

                            <div class="controls">
                               <input id="qq_number" name="qq_number" placeholder="QQ号码" type="text" style="width: 140px;" onkeyup="this.value=this.value.replace(/\D/g,'')">
                                <button type="button" class="btn btn-primary btn-sm" onclick="add_qqs();" id="add_qq">新增</button>
                                <input id="qq_number2" name="qq_number2" placeholder="QQ号码2" type="text" style="width: 140px; display:none;" onkeyup="this.value=this.value.replace(/\D/g,'')">
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">微信号码</label>

                            <div class="controls">
                               <input id="weixin_number" name="weixin_number" placeholder="微信号码" type="text" style="width: 140px;">
                                <button type="button" class="btn btn-primary btn-sm" onclick="add_weixins();" id="add_weixin">新增</button>
                                <input id="weixin_number2" name="weixin_number2" placeholder="微信号码2" type="text" style="width: 140px; display:none;">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label" style="background-color: #bce8f1">预约时间</label>

                            <div class="controls">
                                <input id="expect_time" name="expect_time" class="input-large" type="text" />
                            </div>
                        </div>

                    </div>

                    </div>

            </div>
        </div>
    </div>

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#shujuziliao">
                <i class="icon-chevron-down"></i> 数据资料
            </a>
        </div>
        <div id="shujuziliao" class="accordion-body collapse in">
            <div class="accordion-inner">
                <div class="row-fluid" style="padding-bottom: 0">
                    <div class="row-fluid">
                        <div class="span6">
                            <div class="control-group">
                                <label class="control-label">客户类型</label>
                                <div class="controls">
                                   <input id="customer_type" name="customer_type" placeholder="客户类型" type="text" readonly="" style="width:110px">
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">客户来源</label>
                                <div class="controls">
                                    <select id="origin" name="origin" class="space">
                                        <option></option>
                                        {%- for k,v in config['USER_ORIGINS'].iteritems() -%}
                                            <option value="{{ k }}">{{ v }}</option>
                                        {%- endfor -%}
                                    </select>
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">意向等级</label>
                                <div class="controls">
                                    <select id="intent_level" name="intent_level" class="space">
                                        {% if current_user.assign_user_type==1 %}
                                            {% for k in config['NEW_USER_INTENT_LEVELS_SORT'] %}
                                                <option value="{{ k }}">{{ config['NEW_USER_INTENT_LEVELS'][k] }}</option>
                                            {% endfor %}
                                        {% endif %}
                                        {% if current_user.assign_user_type==2 %}
                                            {% for k in config['VIP_USER_INTENT_LEVELS_SORT'] %}
                                                <option value="{{ k }}">{{ config['VIP_USER_INTENT_LEVELS'][k] }}</option>
                                            {% endfor %}
                                        {% endif %}
                                        {% if current_user.assign_user_type==5 %}
                                            {% for k in config['SERVICE_USER_INTENT_LEVELS_SORT'] %}
                                                <option value="{{ k }}">{{ config['SERVICE_USER_INTENT_LEVELS'][k] }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">活动备注</label>
                                <div class="controls">
                                    <select id="activity" name="activity" class="space">
                                        <option></option>
                                        {%- for k,v in config['ACTIVITY_STATUS'].iteritems() -%}
                                            <option value="{{ k }}">{{ v }}</option>
                                        {%- endfor -%}
                                    </select>
                                </div>
                             </div>

                            <div class="control-group">
                                <label class="control-label">产品活动意向</label>
                                <div class="controls">
                                    <select id="product_intention" name="product_intention3" class="space" style="width: 285px">
                                        <option></option>
                                        {%- for item in items -%}
                                            <option value="{{ item.id }}" price="{{ item.price }}" integration="{{ item.integration }}" sku-id="{{ item.sku_id }}" unit="{{ item.unit }}" type="{{ item.type }}"{% if item.type==2 %} class="sku_set_style"{% endif %}>{{ item.name }}</option>
                                        {%- endfor -%}
                                    </select>
                                    <!--<button type="button" class="btn btn-primary btn-sm" onclick="add_product_intentions();" id="add_product_intention">新增</button>-->
                                    <select id="product_intention2" name="product_intention2" class="space" style="width: 285px;">
                                        <option></option>
                                        {%- for item in items -%}
                                            <option value="{{ item.id }}" price="{{ item.price }}" integration="{{ item.integration }}" sku-id="{{ item.sku_id }}" unit="{{ item.unit }}" type="{{ item.type }}"{% if item.type==2 %} class="sku_set_style"{% endif %}>{{ item.name }}</option>
                                        {%- endfor -%}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="span6">
                            <div class="control-group">
                                <label class="control-label">复购次数</label>
                                <div class="controls">
                                   <input id="buy_more_time" name="buy_more_time" placeholder="复购次数" type="text" readonly="">
                                </div>
                            </div>

                             <div class="control-group">
                                <label class="control-label">复购金额</label>
                                <div class="controls">
                                   <input id="buy_more_money" name="buy_more_money" placeholder="复购金额" type="text" readonly="">
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label">新品需求</label>
                                <div class="controls">
                                   <input id="new_goods_need" name="new_goods_need" placeholder="新品需求" type="text">
                                </div>
                            </div>
                         </div>
                    </div>

                    <div class="row-fluid">
                        <div class="span12">
                        {% if current_user.team=='B2' or current_user.is_admin==1 %}
                        <div class="control-group">
                            <label class="control-label">TQ进线选择</label>

                            <div class="controls">
                                来源:
                                    {% for k,v in config['TQ_ORIGIN'].iteritems() %}
                                        <label class="inline radio"><input type="radio" name="tq_origin" value="{{ k }}"/>{{ v }}</label>
                                    {% endfor %}
                                        <input type="radio" style="display:none;" name="tq_origin" checked="checked" value="0" />
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                类型:
                                    {% for k,v in config['TQ_TYPE'].iteritems() %}
                                        <label class="inline radio"><input type="radio" name="tq_type" value="{{ k }}"/>{{ v }}</label>
                                    {% endfor %}
                                        <input type="radio" style="display:none;" name="tq_type" checked="checked" value="0" />
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                客户：
                                    {% for k,v in config['TQ_USER'].iteritems() %}
                                        <label class='inline radio'><input type="radio" name="tq_user" value="{{ k }}"/>{{ v }}</label>
                                    {% endfor %}
                                    <input type="radio" style="display:none;" name="tq_user" checked="checked" value="0" />
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                省市：
                                <select id="tq_province" name="tq_province" style="width: 135px"></select>
                                <select id="tq_city" name="tq_city" style="width: 150px"></select>
                            </div>
                        </div>
                        {% endif %}
                        {% if current_user.team in ('C1','C2','C') or current_user.is_admin==1 %}
                        <div class="control-group">
                            <label class="control-label">微信情况</label>

                            <div class="controls">
                                {% for k,v in config['WEIXINS'].iteritems() %}
                                    <label class="inline checkbox"><input type="checkbox" name="weixins" value="{{ k }}"/>{{ v }}</label>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        {% if current_user.team =='A2' or current_user.is_admin==1 %}
                        <div class="control-group">
                            <label class="control-label" style="background-color: #fdf59a">媒体来源</label>

                            <div class="controls" id="medias">
                                <select id="m1" name="m1" style="width: 200px"></select>
                                <select id="m2" name="m2" style="width: 200px"></select>
                                <select id="m3" name="m3" style="width: 200px"></select>
                            </div>
                        </div>
                        {% endif %}
                        {% if current_user.team =='C3' or current_user.is_admin==1 %}
                        <div class="control-group">
                            <label class="control-label">新老客户</label>

                            <div class="controls">
                                <label style="float:left; padding-right:15px;"><input name="is_new" value="0" type="radio">老客户</label>
                                <label><input name="is_new" value="1" type="radio" checked="checked">新客户</label><br />
                                <!--<label>复购次数:<input id="fugou" name="fugou" class="input-large" type="text" />新客户为0，可不填写</label>-->
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">病症</label>

                            <div class="controls">
                                <textarea name="disease" style="width:600px; height:80px;" class="input"></textarea>
                            </div>
                        </div>
                        {% endif %}
                        <hr/>
                    </div>
                </div>
                </div>
            </div>
         </div>
    </div>


<!--     {% if current_user.team in ('A','A1','A2','B','B1','B2')  %}
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#collapsedlb">
                <i class="icon-chevron-down"></i> 大礼包
            </a>
        </div>
        <div id="collapsedlb" class="control-group collapse in">
            <div class="controls" style="padding:40px;">
                <label style="float:left; padding-right:15px;">类型
                <select name="dlb_type" id="dlb_type">
                <option></option>
                {%- for k,v in config['DLB_TYPES'].iteritems() -%}
                    <option value="{{ k }}">{{ v }}</option>
                {%- endfor -%}
                </select></label>
                <label style="float:left; padding-right:15px;">是否有效
                <select name="dlb_valid" id="dlb_valid">
                <option></option>
                <option value="1">有效</option>
                <option value="2">无效</option>
                </select></label>
                <label style="float:left; padding-right:15px;">新老客户
                <select name="dlb_new" id="dlb_new">
                <option></option>
                <option value="1">新客户</option>
                <option value="2">老客户</option>
                </select></label>
                <label style="float:left; padding-right:15px;">是否接通
                <select name="dlb_connect" id="dlb_connect">
                <option></option>
                <option value="1">接通</option>
                <option value="2">不通</option>
                </select></label>
            	
            </div>
        </div>
    </div>
	{% endif %} -->

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#marketData">
                <i class="icon-chevron-down"></i> 市场数据
            </a>
        </div>
        <div class="accordion-inner">
            <div class="row-fluid" style="padding-bottom: 0">
                <div class="span6">
                    <div class="control-group">
                        <label class="control-label">日期</label>
                        <div class="controls">
                           <input id="market_time" name="market_time" placeholder="日期" type="text"  style="width:155px">
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">数据类型</label>
                        <div class="controls">
                            <select id="data_markup" name="data_markup" class="space">
                                <option></option>
                                {%- for k,v in config['DATA_MARKUP'].iteritems() -%}
                                    <option value="{{ k }}">{{ v }}</option>
                                {%- endfor -%}
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">市场</label>
                        <div class="controls">
                            <select id="market_province" name="market_province" style="width: 135px"></select>
                            <select id="market_city" name="market_city" style="width: 135px"></select>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">提交人</label>
                        <div class="controls">
                           <input type="text" id="market_person" value=""/>
                        </div>
                    </div>
                </div>
                <div class="span6">
                    <div class="control-group">
                        <label class="control-label">药房名称</label>
                        <div class="controls">
                           <input type="text" id="market_yaofang" value=""/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">购买量</label>
                        <div class="controls">
                           <input type="text" id="market_gmd" value="" placeholder="大盒"/>
                            <input type="text" id="market_gmx" value="" placeholder="小盒"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">购买判定</label>
                        <div class="controls">
                            <select id="judge_gm" name="">
                                <option ></option>
                                <option value="1">购买</option>
                                <option value="2">未购买</option>
                                <option value="3">无法确定</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">有效性判定</label>
                        <div class="controls">
                            <select id="judge_valid" name="">
                                <option ></option>
                                <option value="1">有效</option>
                                <option value="2">无效</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#collapseTwo2">
                <i class="icon-chevron-down"></i> 身体状态
            </a>
        </div>
        <div id="collapseTwo2" class="control-group collapse in">
           <div class="controls" style="margin-left: 0px;">
               <hr/>
               <input type="hidden" class="symptoms" value="" name="symptoms" />
                {% for module_keys in perms %}
                    <table class="table" data-toggle="table" style="width:45%;height:250px ;float:left;">
                        <p style="float:left; font-size:18px; font-weight:bold;">{{ config['USER_ORGIN'][module_keys] }}</p>
                        {% for symptom_keys in perms[module_keys]  %}
                            {% for symptom_key in symptom_keys  %}
                            <tr>
                                <td style="text-align:center; float:left; border-right:1px solid #bec3c7;border:1px solid #bec3c7; font-weight:bold;">{{ config['USER_ORGIN_TYPE'][symptom_key] }}：</td>
                                {% for symptom in symptom_keys[symptom_key][0]  %}
                                    <td style="float:left; border:1px solid #bec3c7;cursor:pointer;"  onclick="td_click('{{symptom}}');" >
                                        <div class="selection" id="selection_{{symptom}}"></div>
                                        {{ config['USER_ORGIN_TYPE_DETAIL'][symptom] }}
                                    </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        {% endfor %}
                    </table>
                    {% endfor %}
            </div>
        </div>
    </div>
    
{#    <div class="accordion-group">#}
{#        <div class="accordion-heading">#}
{#            <a class="accordion-toggle" data-toggle="collapse" href="#collapseFour">#}
{#                <i class="icon-chevron-down"></i> 家庭状况#}
{#            </a>#}
{#        </div>#}
{#        <div id="collapseFour" class="accordion-body collapse">#}
{#            <div class="accordion-inner">#}
{#                <div class="row-fluid">#}
{#                    <div class="span6">#}
{#                        <div class="control-group">#}
{#                            <label class="control-label">家庭成员</label>#}
{##}
{#                            <div class="controls">#}
{#                                <label class="checkbox inline"><input type="checkbox" name="family_members" value="1">父亲</label>#}
{#                                <label class="checkbox inline"><input type="checkbox" name="family_members" value="2">母亲</label>#}
{#                                <label class="checkbox inline"><input type="checkbox" name="family_members" value="4">儿子</label>#}
{#                                <label class="checkbox inline"><input type="checkbox" name="family_members" value="8">女儿</label>#}
{#                                <label class="checkbox inline"><input type="checkbox" name="family_members" value="16">配偶</label>#}
{#                            </div>#}
{#                        </div>#}
{##}
{#                    </div>#}
{#                    <div class="span6">#}
{#                        <div class="control-group">#}
{#                            <label class="control-label">家庭成员说明</label>#}
{##}
{#                            <div class="controls">#}
{#                                <textarea style="width: 340px"></textarea>#}
{#                            </div>#}
{#                        </div>#}
{##}
{#                        <div class="control-group">#}
{#                            <label class="control-label">健康状况</label>#}
{##}
{#                            <div class="controls">#}
{#                                <textarea style="width: 340px"></textarea>#}
{#                            </div>#}
{#                        </div>#}
{##}
{#                    </div>#}
{#                </div>#}
{##}
{#            </div>#}
{#        </div>#}
{#    </div>#}


    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#addressModule">
                <i class="icon-chevron-down"></i> 客户地址
            </a>
        </div>
        <div id="addressModule" class="accordion-body collapse in">
            <div class="accordion-inner">
                <div class="row-fluid">
                    <div class="span12">
                        <hr/>
                        <div class="control-group">
                            <label class="control-label">客户地址</label>

                            <div class="controls" id="address">
                                <select id="province" name="province" style="width: 135px"></select>
                                <select id="city" name="city" style="width: 150px"></select>
                                <select id="district" name="district" style="width: 150px"></select>

                                <input type="text" id="street1" name="street1" class="input input-large"
                                       style="width: 340px" placeholder="详细地址"/>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">邮政编码</label>

                            <div class="controls">
                                <input type="text" id="postcode" name="postcode" class="input"
                                       placeholder="邮政编码"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="accordion-group navbar navbar-fixed-bottom">
        <div class="accordion-heading" style="background-color:#e0f2be">
            <a class="accordion-toggle" data-toggle="collapse" href="#dialogModule">
                <i class="icon-chevron-down"></i> 沟通记录
            </a>
        </div>
        <div id="dialogModule" class="accordion-body collapse in">
            <div class="accordion-inner">
                <div class="row-fluid">
                    <div class="span3" style="text-align: left;font-size:20px;">
                        <p>拨打记录:</p>
                    </div>
                    <div class="span3" style="text-align: left;font-size:20px;">
                        <p></p>
                    </div>
                    <div class="span6" style="text-align: left; font-size:20px;">
                        <p>沟通记录:</p>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span3" style="text-align: left">
                        <div class="input-prepend space">
                            <span class="add-on">沟通方式：</span>
                            <select id="communicate_mode" name="communicate_mode" class="space">
                                <option value="0"></option>
                                {% for va,vl in config['COMMUNICATE_MODE'].iteritems() %}
                                    <option value="{{ va }}">{{ vl }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="input-prepend space"  style="margin-top:6px;">
                            <span class="add-on">沟通情况：</span>
                            <select id="connect_situation" name="connect_situation" class="space">
                                <option value="0"></option>
                                <option value="1">沟通</option>
                                <option value="2">未沟通</option>
                            </select>
                        </div>
                        <div class="input-prepend space"  style="margin-top:6px;">
                            <span class="add-on">沟通属性：</span>
                             <select id="communication_attr" name="communication_attr" class="space">
                                 <option value="0"></option>
                                <option value="1">有效沟通</option>
                                <option value="2">无效沟通</option>
                             </select>
                        </div>
                    </div>
                    <div class="span3" style="text-align: left">
                         <div class="input-prepend space">
                            <span class="add-on">通话时长：</span>
                            <input name="talk_time" id="talk_time" type="text" data-person="通话时长" style="width:200px;" placeholder="00:00:00">
                         </div>
                         <div class="input-prepend space"  style="margin-top:6px;">
                            <span class="add-on">录音编号：</span>
                            <input name="record_number" id="record_number" type="text" data-person="录音编号" style="width:200px;">
                         </div>
                    </div>
                    <div class="span6" style="text-align: ;left">
                        <textarea name="dialog_content" id="dialog_content"
                                  style="width:265px;height:90px;background-color:#f5f3ef;overflow-y: auto"
                                  placeholder="沟通内容"></textarea>
                        <button type="submit" class="btn btn-primary">保存客户</button>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    </div>

    </div>

    </fieldset>
    </form>
{%- endblock -%}